#!/bin/sh

echo "[Init Stage1 Started]"

LOG_DIR="/var/log/Stage1"
mkdir -p "$LOG_DIR"

for i in /etc/init.d/S??*; do
    # Ignore dangling symlinks or non-files
    [ ! -f "$i" ] && continue

    name="$(basename "$i")"
    logfile="$LOG_DIR/$name.log"

    echo -n "Starting $name ... "

    case "$i" in
        *.sh)
            (
                trap - INT QUIT TSTP
                set start
                . "$i"
            ) >"$logfile" 2>&1
            status=$?
            ;;
        *)
            "$i" start >"$logfile" 2>&1
            status=$?
            ;;
    esac

    if [ "$status" -eq 0 ]; then
        echo "[OK]"
    else
        echo "[FAIL]"
        echo "  â†³ see $logfile"
    fi
done

echo "[Init Stage1 Completed]"
