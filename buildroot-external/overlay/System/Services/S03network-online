#!/bin/sh

IFACE=""
TIMEOUT=2   # seconds
INTERVAL=1
PING_TARGET="8.8.8.8"   # Google DNS
DNS_TEST="bing.com"     # Domain resolution test
MAX_ATTEMPTS=5


check_network() {
    ip route get "$PING_TARGET" >/dev/null 2>&1 && \
    ping -c 1 -W 2 "$PING_TARGET" >/dev/null 2>&1 && \
    ping -c 1 -W 2 "$DNS_TEST" >/dev/null 2>&1
}

start() {
    attempts=0
    while [ $attempts -lt $MAX_ATTEMPTS ]; do
        if check_network; then
            echo "✅ Interface is initialised!"
            return 0
        fi
        echo "⌛ Waiting for network to come online (attempt $((attempts + 1)))"
        attempts=$((attempts + 1))
        sleep "$TIMEOUT"
    done
}

stop() {
    echo "Service is not a daemon and thus is not stopped."
    return 0
}

restart() {
    stop
    sleep 1
    start
}

case "$1" in
    start) start ;;
    stop) stop ;;
    restart) restart ;;
    *)
        echo "Usage: $0 {start|stop|restart}"
        exit 1
        ;;
esac
